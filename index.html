<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); padding: 20px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
        button { padding: 10px 20px; background-color: var(--tg-theme-button-color, #3390ec); color: white; border: none; border-radius: 8px; cursor: pointer; }
        ul { list-style: none; padding: 0; }
        li { background: var(--tg-theme-secondary-bg-color, #f5f5f5); margin-bottom: 10px; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
        .del-btn { color: red; cursor: pointer; font-weight: bold; margin-left: 10px;}
    </style>
</head>
<body>
    <h3>üìù –ú–æ–∏ –∑–∞–¥–∞—á–∏</h3>
    <div class="input-group">
        <input type="text" id="taskInput" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?">
        <button onclick="addTask()">‚ûï</button>
    </div>
    <ul id="taskList"></ul>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        // --- –í–ê–ñ–ù–û: –°–Æ–î–ê –í–°–¢–ê–í–õ–Ø–ï–ú –¢–í–û–Æ –°–°–´–õ–ö–£ ---
        const API_URL = "https://hosts-dominant-displays-pushed.trycloudflare.com";

        // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–ª–∏ 0 –¥–ª—è —Ç–µ—Å—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
        const userId = tg.initDataUnsafe?.user?.id || 12345;

        // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        async function loadTasks() {
            try {
                let response = await fetch(`${API_URL}/api/get_tasks?user_id=${userId}`);
                let tasks = await response.json();
                let list = document.getElementById('taskList');
                list.innerHTML = ""; // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫
                tasks.forEach(task => renderTask(task));
            } catch (error) {
                console.error(error);
                alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º! –ü—Ä–æ–≤–µ—Ä—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ cloudflared.");
            }
        }